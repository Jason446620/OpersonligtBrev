@page "/my-letters"
@inject ILetterService LetterService
@inject IAccountManagement AuthenticationStateProvider
@inject NavigationManager NavigationManager

<PageTitle>BrevProffsen</PageTitle>
<AuthorizeView>
    <Authorized>
        <div class="container">
            <div class="row">
                <div class="col mb-3">
                    <ul class="list-group">
                        <Virtualize Context="letter" Items="Letters">
                            <li class="list-group-item">
                                @letter.Title
                            </li>
                        </Virtualize>
                    </ul>
                </div>
                <div class="col mb-3">
                    <BootStrapTextArea Rows="12"/>
                </div>
            </div>
        </div>
        
        

    </Authorized>
    <NotAuthorized>
        404 not found
    </NotAuthorized>
</AuthorizeView>

@code {

    public List<LetterModel> Letters { get; set; } = new();
    private string UserEmail { get; set; } = string.Empty;
    private string activeLetterContent = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        var isAuth = await AuthenticationStateProvider.CheckAuthenticatedAsync();

        if (isAuth)
        {
            UserEmail = await AuthenticationStateProvider.GetUserEmailAsync();

            var letters = await LetterService.GetAllByUserEmailAsync(UserEmail);
            Letters.AddRange(letters);
        }
        else
        {
            NavigationManager.NavigateTo("./");
        }




    }
}